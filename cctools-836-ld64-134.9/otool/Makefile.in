builddir = @builddir@
top_builddir = @top_builddir@
srcdir = @srcdir@
top_srcdir = @top_srcdir@

prefix		= @prefix@
exec_prefix	= @exec_prefix@
bindir		= @bindir@

VPATH = @srcdir@

CC              = @CC@
CFLAGS          = @CFLAGS@ -D__DARWIN_UNIX03
WARNINGS	= @WARNINGS@
MDYNAMICNOPIC   = @MDYNAMICNOPIC@
CPPFLAGS        = @CPPFLAGS@ -D__DARWIN_UNIX03
DEFS            = @DEFS@ @ENDIAN_FLAG@
LDFLAGS         = @LDFLAGS@
OBJC		= @OBJC@
HAVE_PRIVEXT    = @HAVE_PRIVEXT@
HAVE_FOREIGN_HEADERS    = @HAVE_FOREIGN_HEADERS@
LTO_DEFS    = @LTO_DEFS@

ifeq ($(HAVE_PRIVEXT),NO)
INCPRIVEXT      = -include $(top_srcdir)/include/extern.h
endif

ifeq ($(HAVE_FOREIGN_HEADERS),YES)
FORHDRS         = -I$(top_srcdir)/include/foreign
endif

INSTALL		= @INSTALL@
INSTALL_PROGRAM	= @INSTALL_PROGRAM@
transform       = @program_transform_name@

MYINCLUDES      = -I$(builddir) -I$(srcdir) -I$(top_builddir)/include \
			-I$(top_srcdir)/include $(INCPRIVEXT) $(FORHDRS)

MYINCLUDES		+= -I$(top_srcdir)/libobjc2
MYWARNINGS      = 
MYDEFS          =
MYLDFLAGS	= -L$(top_builddir)/libstuff -ldl
MYLIBS		=

MYCOMPILEFLAGS	= $(WARNINGS) $(MYWARNINGS) $(DEFS) $(MYDEFS) \
	$(CPPFLAGS) $(MYINCLUDES) $(CFLAGS) $(MDYNAMICNOPIC) $(LTO_DEFS) 

MYLINKFLAGS	= $(LDFLAGS) $(MYLDFLAGS) $(MYLIBS)

CFILES = main.c ofile_print.c m68k_disasm.c i860_disasm.c \
         m88k_disasm.c i386_disasm.c ppc_disasm.c hppa_disasm.c \
         sparc_disasm.c arm_disasm.c

OBJCFILES = print_objc.c print_objc2_32bit.c print_objc2_64bit.c
OBJCOBJS = $(OBJCFILES:.c=.o) 
LDFLAGS += -L$(top_builddir)/libobjc2 -lobjc -lpthread 

OBJS = $(CFILES:.c=.o) 

.PHONY: default clean distclean install

default: otool

$(OBJS): %.o: %.c
	$(CC) $(MYCOMPILEFLAGS) -c -o $@ $<

$(OBJCOBJS): %.o: %.c
	$(CC) $(OBJC) $(MYCOMPILEFLAGS) -c -o $@ $<

otool: $(OBJS) $(OBJCOBJS)
	$(CC) -o $@ $^ $(MYLINKFLAGS) -lstuff

install: otool
	mkdir -p $(DESTDIR)/$(bindir)
	$(INSTALL_PROGRAM) otool \
		$(DESTDIR)/$(bindir)/`echo otool | sed '$(transform)'`
clean:
	rm -r -f *.o
	rm -f otool
